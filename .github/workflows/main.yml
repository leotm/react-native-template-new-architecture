name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows run workflow from Actions tab
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3

      - name: Install with Yarn
        run: yarn && yarn setup

      - name: Run @lavamoat/git-safe-dependencies
        run: yarn git-safe-dependencies

      - name: Run @lavamoat/git-safe-dependencies (git-safe-actions)
        run: yarn git-safe-actions

      - name: Compile with TypeScript
        run: yarn tsc

      - name: Lint with ESLint
        run: yarn lint

      - name: Test with Jest
        run: yarn test
